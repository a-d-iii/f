---
import Base from '../layouts/Base.astro';
import faculty from '../data/faculty.json';
import FacultyCard from '../components/FacultyCard.astro';
import { paginate, PER_PAGE } from '../utils/pagination';
import MiniSearch from 'minisearch';
const page = 1;
const url = new URL(Astro.request.url);
const query = url.searchParams.get('q') ?? '';

let list = faculty;
if (query) {
  const miniSearch = new MiniSearch({
    fields: ['name'],
    storeFields: ['id']
  });
  miniSearch.addAll(faculty.map(f => ({ id: f.id, name: f.name })));
  const results = miniSearch.search(query, { prefix: true, fuzzy: 0.2 });
  const map = new Map(faculty.map(f => [f.id, f]));
  list = results.map(r => map.get(r.id)).filter(Boolean);
}
---
<Base>
  <div class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-4 gap-4">
    {paginate(list, page).map(f => (
      <FacultyCard faculty={f} />
    ))}
  </div>
  <nav class="mt-4 flex justify-center gap-2">
    <a href="/page/2" class="px-4 py-2 rounded-lg bg-black text-white hover:bg-gray-800">Next &rarr;</a>
  </nav>
</Base>
